#!/usr/bin/env python3
from z8_pred import z8_pred
import sol1
import prandom_sol


sequences = [[0.1871985177521347, 0.010771605907229143, 0.9128892145215373, 0.934081318056027, 0.8117487176244784],
        [0.9934538256324004, 0.4326984203263846, 0.09416681926216297, 0.45348119865480374, 0.6965561948559205],
        [0.5697174399826916, 0.012972178540732404, 0.6726193720162763, 0.48905489701435045, 0.2552142815396392],
        [0.16467490691569875, 0.7738927305002474, 0.9747310977881793, 0.5260053543360723, 0.10462932563575666],
        [0.6899986485754266, 0.7284756865280175, 0.9712994035684732, 0.6814882665281672, 0.7902910246079404],
        [0.48591645520228965, 0.9829665820602218, 0.8698690353945193, 0.47500519295485377, 0.9791816908941171],
        [0.03937212392631584, 0.7420529113596666, 0.7263885802088239, 0.07035137247517209, 0.7560691137259503],
        [0.7328186954630558, 0.7406642746229917, 0.784216023407337, 0.5989144947598273, 0.825986207877418],
        [0.9073207490731197, 0.860831631950548, 0.5905195042524372, 0.13351636070952244, 0.23537081911388236]]
seq = [8511967123915371993070605081614495529410718307165229484750754124137835019477977814358899969713873259931420940234616773315010395617283294231187372217866142,
    10895779438014302010120713787945421414701194039611472416662442876895841114438459004720467649589079291241658397598249541876363255762230254471992503888133811,
    2937216638184314263634519457540387341690836453047615280254549494056274056351256229763128566848765761288865527306166180837625657375571068787692641165368674,
    2003333793221331514880756090304769448826766169231598215933006991045703252580678361803178093243467971198395287159703108175128542945204436531619254878290623,
    5990922318780760374241556089896333249303830241697296327140055550974775942533797792607824695895609837466888359170852053587100924352563653780240080061474246,
    12134880763863447010386487870088041243299709561528343931989103502331993306362449662746849075697876770423944611875463790196259666885656491960917094346587307,
    5194862952217963616340416053639503868717343730395980380141268449671215147229429581180364022278972307290532743599453109809061776321233296555507225379715530]
enc_flag = '8648282746403164131474271823006915798427302779728830844449350623052294431587486624457221474423678286579453434232080411531688107938943258758041752678501380'

seed = ''
for sequence in sequences:
    x = z8_pred(sequence)
    seed += str(x)[2:]
seed = int(seed)
print(f'seed:\t{seed}')

seq = [seed] + seq
mnc = sol1.mnc(seq)

lcg = prandom_sol.LCG(seed, mnc['m'], mnc['c'], mnc['n'])
for i in range(7):
    lcg.next()
key = lcg.next()
print(f'key:\t{key}')

flag = key^int(enc_flag)
chars = 'abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789_{}'
flag = '0'+str(flag)
print(f'flag (indexes):\t{flag}')
flag_index = [flag[i:i+2] for i in range(0,len(flag),2)]
flag = [chars[int(i)] for i in flag_index]
print(''.join(flag))